(()=>{const t="http://localhost:4000/translate",e="custom-tooltip",n="custom-tooltip-word",o="active",i="SPAN",c="ytp-caption-window-container",r="caption-window",a="ytp-caption-segment",s=document.querySelector(".ytp-play-button"),l=document.querySelector("video");let d=null,u=!1;function m(){document.querySelectorAll(`.${e}`).forEach((t=>t.remove()))}function p(t){return t.tagName===i}function g(n){p(n.target)&&async function(n){const i=n.textContent.trim(),a=await async function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"ru";d=new AbortController;const{signal:o}=d;try{const i=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({input:e,sourceLocale:"en",targetLocale:n}),signal:o}),{translations:c}=await i.json();return c}catch(t){if("AbortError"!==t?.name)throw new Error(`Translation error: ${t}`);return console.log("Fetch aborted"),[]}finally{m(),d=null}}(i),s=document.querySelector(`.${r}`);if(!s||!a.length)return;const l=document.createElement("div");l.className=e,l.textContent=a.join(", "),l.style.visibility="hidden",n.setAttribute("data-tooltip",o),document.body.appendChild(l),function(t,e,n){const o=t.getBoundingClientRect(),i=e.offsetHeight;let a;const s=n.getBoundingClientRect();a=function(){const t=document.querySelector(`.${c}`).getBoundingClientRect(),e=document.querySelector(`.${r}`).getBoundingClientRect(),n=t.top+t.height/2;return e.top+e.height/2<n}()?s.bottom+5+window.scrollY:s.top-i-5+window.scrollY,e.style.top=`${a}px`,e.style.left=`${o.left+window.scrollX}px`,e.style.visibility="visible"}(n,l,s)}(n.target)}function y(t){p(t.target)&&(m(),document.body.contains(t.target)&&t.target.getAttribute("data-tooltip")===o&&t.target.removeAttribute("data-tooltip"),d&&d.abort())}function f(t){"SPAN"===t.target.tagName&&navigator.clipboard.writeText(t.target.textContent.trim())}function h(t){const e=t.textContent.trim().split(/\s+/);t.textContent="",e.forEach((e=>{const o=document.createElement("span");o.classList.add(n),o.textContent=e+" ",o.addEventListener("mouseenter",g),o.addEventListener("mouseleave",y),o.addEventListener("click",f),t.appendChild(o)}))}function v(){u=l.paused,l.paused||s.click()}function E(){l.paused&&!u&&s.click(),u=!1}function w(){const t=new MutationObserver((t=>{t.forEach((t=>{t.addedNodes.forEach((t=>{if(t.querySelectorAll&&(t.querySelectorAll(`.${a}`).forEach(h),function(){const t=document.querySelectorAll(`.${a}`);let e=0;t.forEach((t=>{const n=t.getBoundingClientRect();e=Math.max(e,n.width)}));const n=document.querySelector(`.${r}`);n&&(n.style.width=`${e}px`)}()),t.nodeType===Node.TEXT_NODE){const e=t.parentElement;e&&e.classList.contains(a)&&h(e)}t.classList&&t.classList.contains(r)&&(t.addEventListener("mouseenter",v),t.addEventListener("mouseleave",E))})),t.removedNodes.forEach((t=>{t.classList&&t.classList.contains(r)&&(t.removeEventListener("mouseenter",v),t.removeEventListener("mouseleave",E),m())}))}))})),e=document.querySelector(`.${c}`);e&&t.observe(e,{childList:!0,subtree:!0})}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",w):w()})();